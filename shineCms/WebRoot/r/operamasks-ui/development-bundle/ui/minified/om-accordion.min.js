(function(b,c){var a="om-accordion-panel-"+(((1+Math.random())*65536)|0).toString(16).substring(1)+"-",d=0;b.widget("om.omAccordion",{options:{active:0,autoPlay:false,collapsible:false,disabled:false,height:"auto",iconCls:null,interval:1000,switchEffect:false,switchMode:"click",width:"auto",onActivate:function(e){},onBeforeActivate:function(e){},onBeforeCollapse:function(e){},onCollapse:function(e){}},activate:function(f){var e=this.options;clearInterval(e.autoInterId);f=this._correctIndex(f);f=f==-1?0:f;this._activate(f);this._setAutoInterId(this);return this},disable:function(){var g=b.data(this.element,"panels");var e=g.length;while(e--){b(g[e]).omPanel("disable")}var f=this.options;if(f.autoPlay){clearInterval(f.autoInterId)}f.disabled=true},enable:function(){var f=b.data(this.element,"panels");var e=f.length;while(e--){b(f[e]).omPanel("enable")}this._buildEvent();this.options.disabled=false},getActivated:function(){var e=b.data(this.element,"panels"),f=this.options.active;return f===-1||!this.element.data("hasCreated")?null:b(e[f]).omPanel("body").prop("id")},getLength:function(){return b.data(this.element,"panels").length},reload:function(f){var e=b.data(this.element,"panels");if(this.options.disabled!==false||e.length===0){return this}f=this._correctIndex(f);b(e[f]).omPanel("reload")},resize:function(){if(this.options.disabled!==false){return this}var k=this.element,f=b.data(this.element,"panels"),e=f.length,h;this._initWidthOrHeight("width");this._initWidthOrHeight("height");if(this.options.height!=="auto"){h=k.innerHeight();var g;for(g=0;g<e;g++){h-=b(f[g]).omPanel("panel").outerHeight(true)}var l=this.getActivated();if(l){h+=k.find("#"+l).omPanel("body").outerHeight()}for(g=0;g<e;g++){var j=b(f[g]).omPanel("body");j.height(h-(j.outerHeight()-j.height()))}}else{for(g=0;g<e;g++){var j=b(f[g]).omPanel("body");j.css("height","")}}return this},setTitle:function(f,g){var e=b.data(this.element,"panels");if(this.options.disabled!==false||e.length===0){return this}f=this._correctIndex(f);b(e[f]).omPanel("header").find(">div.om-panel-title").html(g);return this},url:function(h,g){var f=b.data(this.element,"panels"),e=f.length;if(!g||this.options.disabled!==false||f.length===0){return}h=this._correctIndex(h);b(f[h]).omPanel("options",{url:g})},_create:function(){var j=this.element,i=this.options,h=[],e,g=i.active,f;j.addClass("om-widget om-accordion");this._renderPanels();this.resize();g=this._correctIndex(g);if(g!=-1||!(i.collapsible!==false)){g=g==-1?0:g;this._activate(g)}i.disabled!==false?this.disable():this._buildEvent();j.data("hasCreated",true)},_correctIndex:function(i){var k=this.element,h=this.options,g=b.data(this.element,"panels"),f=k.children().find(">div#"+i),e=g.length,l=i;i=f.length?b(g).index(f):i;i=i==-1?l:i;var j=parseInt(i);j=(isNaN(j)&&"0"||j)-0;return e==0||j==-1&&!k.data("hasCreated")?-1:(j<0?0:(j>=e?e-1:j))},_renderPanels:function(){var h=this.element,e=this,g=[],f=this.options;var i=h.find("ul:first");i.find("a").each(function(m){var k=this.getAttribute("href",2);var t=k.split("#")[0],u;if(t&&(t===location.toString().split("#")[0]||(u=b("base")[0])&&t===u.href)){k=this.hash;this.href=k}var o=b(this);var q={title:o.text(),tools:["collapse"],iconCls:o.attr("iconCls"),clickExpand:true,onExpand:function(){f.onActivate(m)},collapsed:true,onCollapse:function(){if(h.data("hasCreated")){f.onCollapse(m)}},border:true};var r=b(">"+k,h);var s=r.prop("id");if(!!(r[0])){if(!s){r.prop("id",a+(d++))}q.content=r.html();g.push(e._createPanel(r[0],q))}else{q.url=o.attr("href");var j=e._createPanel(b("<div></div>")[0],q);g.push(j);var l=o.prop("id");b(j).prop("id",l?l:a+(d++))}b(g[m]).omPanel("panel").appendTo(h);if(m===0){var p=b(g[0]).omPanel("header");p.css("border-top-width",p.css("border-bottom-width"))}});b.data(h,"panels",g);i.remove()},_initWidthOrHeight:function(f){var i=this.element,e=this.options,g=this.element.attr("style"),h=e[f];if(g&&g.indexOf(f)!=-1&&!i.data("hasCreated")){e[f]=i.css(f)}else{if(h==="fit"){e[f]="100%";i.css(f,"100%")}else{i.css(f,h==="auto"?"":h)}}},_createPanel:function(f,e){b(f).omPanel(e);return f},_buildEvent:function(){var f=this.options,e=this;this.element.children().find(">div.om-panel-header").each(function(h){var g=b(this);g.unbind();g.find("div.om-panel-tool").children().unbind();g.hover(function(){b(this).addClass("om-state-hover")},function(){b(this).removeClass("om-state-hover")});if(f.switchMode=="mouseover"){g.bind("mouseenter.omaccordions",function(i){clearInterval(f.autoInterId);var j=b.data(e.element,"expandTimer");(typeof j!=="undefined")&&clearTimeout(j);j=setTimeout(function(){e._activate(h,true);e._setAutoInterId(e)},200);b.data(e.element,"expandTimer",j)})}else{if(f.switchMode=="click"){g.bind("click.omaccordions",function(i){clearInterval(f.autoInterId);e._activate(h,true);e._setAutoInterId(e)})}}});if(f.autoPlay){clearInterval(f.autoInterId);e._setAutoInterId(e)}},_setAutoInterId:function(e){var f=e.options;if(f.autoPlay){f.autoInterId=setInterval(function(){e._activate("next")},f.interval)}},_setOption:function(h,k){b.Widget.prototype._setOption.apply(this,arguments);var g=this.options;switch(h){case"active":var l=this.getActivated();if(k=="-1"&&g.collapsible!==false&&g.disabled===false){var e=l,j,i;l=this._correctIndex(l);if(e&&g.onBeforeCollapse.call(this,l)!==false){if(g.switchEffect){j=true;i="fast"}var f=b.data(this.element,"panels");b(f[l]).omPanel("collapse",j,i);g.active=-1}break}this.activate(this._correctIndex(k));break;case"disabled":k===false?this.enable():this.disable();break;case"width":if(k=="fit"){g.width="100%"}break;case"height":if(k=="fit"){g.height="100%"}break}},_activate:function(l,n){var o=b.data(this.element,"panels"),m=o.length,r=this.options,q=this,j=false,k=-1,g,e;if(r.disabled!==false&&this.element.data("hasCreated")||m===0){return}l=l==="next"?(r.active+1)%m:q._correctIndex(l);if(r.switchEffect){g=true;e="fast"}for(var h=0;h<m;h++){b(o[h]).stop(true,true)}var f=q.getActivated();j=!!f;if(j){k=q._correctIndex(f);if(k==l){if(n===true&&r.collapsible!==false&&r.onBeforeCollapse.call(q,k)!==false){b(o[k]).omPanel("collapse",g,e);r.active=-1}}else{var p;if(r.onBeforeCollapse.call(q,k)!==false&&((p=r.onBeforeActivate.call(q,l)!==false)||r.collapsible!==false)){b(o[k]).omPanel("collapse",g,e);if(p){b(o[l]).omPanel("expand",g,e)}r.active=p?l:-1}}}else{if(r.onBeforeActivate.call(q,l)!==false){b(o[l]).omPanel("expand",g,e);r.active=l}}return this}})})(jQuery);